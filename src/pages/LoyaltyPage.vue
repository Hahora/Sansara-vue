<template>
  <div class="p-4">
    <div class="flex items-center mb-4">
      <router-link to="/" class="btn-back mr-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        –ù–∞–∑–∞–¥
      </router-link>
      <h1 class="page-title text-xl">–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</h1>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div v-if="isLoading" class="flex justify-center items-center py-8">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[#4e5d51]"></div>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div v-else-if="error" class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700 mb-4">
      {{ error }}
    </div>

    <div v-else class="space-y-4">
      <!-- –ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏ -->
      <div class="card">
        <h2 class="section-title">üéÅ <b>–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</b></h2>

        <div class="space-y-3">
          <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-100 rounded-lg p-3">
            <p class="text-blue-800 font-medium">üíé ‚Äì20% –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º—É ¬´–û—á–∏—â–µ–Ω–∏–µ –∏ —Å–∏–ª–∞¬ª</p>
            <p class="text-blue-600 text-sm">–î–ª—è –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏—è</p>
          </div>

          <div class="bg-gradient-to-r from-green-50 to-emerald-50 border border-green-100 rounded-lg p-3">
            <p class="text-green-800 font-medium">üéÇ –ü–æ–¥–∞—Ä–æ–∫ –∏–º–µ–Ω–∏–Ω–Ω–∏–∫–∞–º</p>
            <p class="text-green-600 text-sm">–ß–∞–Ω –Ω–∞ –°–∏–±–∏—Ä—Å–∫–æ–º –æ–≥–Ω–µ –∏–ª–∏ —Å–∫–∏–¥–∫–∞ 10%</p>
          </div>

          <div class="bg-gradient-to-r from-purple-50 to-fuchsia-50 border border-purple-100 rounded-lg p-3">
            <p class="text-purple-800 font-medium">üî• –ß–∞–Ω –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è</p>
            <p class="text-purple-600 text-sm">–ü–æ–¥–∞—Ä–æ–∫ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ</p>
          </div>

          <div class="bg-gradient-to-r from-amber-50 to-yellow-50 border border-amber-100 rounded-lg p-3">
            <p class="text-amber-800 font-medium">üéü –°–ø–µ—Ü—É—Å–ª–æ–≤–∏—è –Ω–∞ –∫–ª—É–±–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</p>
            <p class="text-amber-600 text-sm">–î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –≥–æ—Å—Ç–µ–π</p>
          </div>
        </div>

        <p class="text-black text-sm mt-3 italic">–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–∫–∏–¥–∫–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:</p>
      </div>

      <!-- –ü—Ä–æ–º–æ–∫–æ–¥—ã -->
      <div class="card">
        <h2 class="section-title">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã</h2>

        <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ -->
        <div v-if="activePromos.length > 0" class="space-y-3">
          <div
            v-for="promo in activePromos"
            :key="promo.id"
            class="bg-gray-50 rounded-lg p-3"
          >
            <p class="text-black font-medium">üéü <code>{{ promo.code }}</code> ‚Äî —Å–∫–∏–¥–∫–∞
              <b>{{ promo.discount_percent }}%</b>
              <span v-if="promo.discount_amount">–∏–ª–∏ {{ promo.discount_amount / 100 }} ‚ÇΩ</span>
            </p>

            <div v-if="promo.for_first_visit_only" class="text-xs text-indigo-600 mt-1">
              –¢–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–∏–∑–∏—Ç–∞
            </div>

            <div v-if="promo.max_uses" class="text-xs text-black mt-1">
              –û—Å—Ç–∞–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π: {{ promo.max_uses - promo.current_uses }}
            </div>
          </div>
        </div>
        <div v-else class="bg-gray-50 rounded-lg p-3 mb-3">
          <p class="text-black font-medium">–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, —Å–µ–π—á–∞—Å –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</p>
          <p class="text-black text-sm mt-1">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –Ω–∞—à–∏–º–∏ –Ω–æ–≤–æ—Å—Ç—è–º–∏ ‚Äî –º—ã —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–æ–¥–∏–º –∞–∫—Ü–∏–∏!</p>
        </div>

        <router-link
          :to="{ name: 'BookingWithParams', params: { programType: 'discount' }}"
          class="btn-secondary block text-center"
        >
          üìù –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–º
        </router-link>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
      <div class="space-y-3">
        <router-link
          :to="{ name: 'AuthorPrograms' }"
          class="btn-primary block text-center"
        >
          üìã –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö
        </router-link>
      </div>
    </div>
  </div>
</template>

<script>
import { mapState, mapGetters } from 'pinia';
import { useAppStore } from '@/stores/appStore';

export default {
  name: 'LoyaltyPage',
  computed: {
    ...mapState(useAppStore, ['isLoading', 'error', 'promos']),
    ...mapGetters(useAppStore, ['getActivePromos']),

    activePromos() {
      return this.promos.filter(promo => promo.is_active) || [];
    }
  },
  methods: {
    formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      return date.toLocaleDateString('ru-RU');
    }
  }
}
</script>