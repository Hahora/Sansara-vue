<template>
  <div>
    <!-- –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–∞–Ω–Ω–µ—Ä -->
    <div class="bg-[#4e5d51] text-white p-6">
      <h1 class="text-2xl font-extrabold mb-2">üåø <b>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –°–ê–ù–°–ê–†–£</b></h1>
      <p class="opacity-100 font-semibold">–ü–µ—Ä–≤—ã–π –≥–æ—Ä–æ–¥—Å–∫–æ–π —Ä–µ—Ç—Ä–∏—Ç-—Ü–µ–Ω—Ç—Ä, –≥–¥–µ –±–∞–Ω–Ω—ã–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏ –≤—Å—Ç—Ä–µ—á–∞—é—Ç—Å—è —Å –∑–∞–±–æ—Ç–æ–π –æ —Å–µ–±–µ.</p>
      <p class="opacity-100 italic font-semibold">–ó–¥–µ—Å—å –±–µ–∑–æ–ø–∞—Å–Ω–æ, –±–µ—Ä–µ–∂–Ω–æ –∏ –±–µ–∑ –∞–ª–∫–æ–≥–æ–ª—è. –í—Å—ë –≤–∫–ª—é—á–µ–Ω–æ ‚Äî –≤–æ–∑—å–º–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∫—É–ø–∞–ª—å–Ω–∏–∫ –ø–æ –∂–µ–ª–∞–Ω–∏—é.</p>
      <p v-if="user" class="opacity-100 mt-1 font-semibold">–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, {{ user.first_name || user.username || '–≥–æ—Å—Ç—å' }}!</p>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div v-if="isLoading" class="flex justify-center items-center py-8">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-wood-600"></div>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div v-else-if="error" class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700 mx-4 mt-4 flex justify-between items-start">
      <span>{{ error }}</span>
      <button @click="clearError" class="text-red-700 hover:text-red-900 ml-4">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </button>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –º–µ–Ω—é -->
    <div v-else class="p-4 space-y-4">
      <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
      <router-link to="/profile" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">üë§</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
            <p class="text-sm text-wood-900">–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>

      <!-- –ú–∞–ª—å—á–∏—à–Ω–∏–∫–∏ –∏ –¥–µ–≤–∏—á–Ω–∏–∫–∏ -->
      <router-link to="/bachelor" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">üéâ</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–ú–∞–ª—å—á–∏—à–Ω–∏–∫–∏ –∏ –¥–µ–≤–∏—á–Ω–∏–∫–∏</h3>
            <p class="text-sm text-wood-900">–û—Ç–ø—Ä–∞–∑–¥–Ω—É–π—Ç–µ –≤–∞–∂–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ –≤ –æ—Å–æ–±–µ–Ω–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ!</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>

      <!-- –ö–ª—É–±–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è -->
      <router-link to="/club-events" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">üèõ</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–ö–ª—É–±–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h3>
            <p class="text-sm text-wood-900">–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ –≤ –±–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>

      <!-- –ö–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
      <router-link to="/collective-programs" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">üë•</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–ö–æ–ª–ª–µ–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
            <p class="text-sm text-wood-900">–¢–µ–ø–ª–æ, –∂–∏–≤–æ–π –ø–∞—Ä, –æ–±—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏ –µ–¥–∏–Ω–µ–Ω–∏–µ</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>

      <!-- –ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
      <router-link to="/author-programs" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">‚ú®</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–ê–≤—Ç–æ—Ä—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
            <p class="text-sm text-wood-900">–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏, –≥–ª—É–±–æ–∫–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è, —Ä–∞–±–æ—Ç–∞ —Å —Ç–µ–ª–æ–º –∏ —ç–Ω–µ—Ä–≥–∏–µ–π</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>

      <!-- –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ -->
      <router-link to="/loyalty" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">üéÅ</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏</h3>
            <p class="text-sm text-wood-900">–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —Å–∫–∏–¥–∫–∏ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>

      <!-- –Ø –ø–µ—Ä–≤—ã–π —Ä–∞–∑ -->
      <router-link to="/first-time" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">üåü</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–Ø –ø–µ—Ä–≤—ã–π —Ä–∞–∑</h3>
            <p class="text-sm text-wood-900">–û—Å–æ–±–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤—ã—Ö –≥–æ—Å—Ç–µ–π</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>

      <!-- –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã -->
      <router-link to="/corporate" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">üè¢</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
            <p class="text-sm text-wood-900">¬´–û—Ç–¥—ã—Ö, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –Ω—É–∂–µ–Ω –æ—Ç–¥—ã—Ö¬ª</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>

      <!-- –ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã -->
      <router-link to="/certificates" class="card flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-3xl mr-2">üéÅ</span>
          <div class="ml-4">
            <h3 class="font-semibold text-wood-900">–ü–æ–¥–∞—Ä–æ—á–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</h3>
            <p class="text-sm text-wood-900">–ü–æ–¥–∞—Ä–∏—Ç–µ –∑–∞–±–æ—Ç—É, —Å—á–∞—Å—Ç—å–µ –∏ —Ä–µ—Å—É—Ä—Å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</p>
          </div>
        </div>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-wood-900" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
        </svg>
      </router-link>
    </div>
  </div>
</template>

<script>
import { mapState, mapActions } from 'pinia';
import { useAppStore } from '@/stores/appStore';

export default {
  name: 'HomePage',
  computed: {
    ...mapState(useAppStore, ['isLoading', 'error', 'user', 'programsLoaded', 'eventsLoaded'])
  },
  methods: {
    ...mapActions(useAppStore, ['authenticate', 'loadPrograms', 'loadEvents', 'loadCertificates', 'loadPromos', 'loadLotteryData', 'clearError'])
  },
  async created() {
    console.log('HomePage created, checking authentication...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ —É–∂–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    if (!this.programsLoaded || !this.eventsLoaded) {
      console.log('Authenticating user...');
      await this.authenticate();

      // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–∫—É
      console.log('After authentication:', {
        user: this.user,
        isAuthenticated: this.isAuthenticated
      });

      // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–µ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      // –û—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
      if (this.isAuthenticated) {
        console.log('Loading programs and events...');
        await Promise.allSettled([
          this.loadPrograms(),  // –ü—Ä–æ–≥—Ä–∞–º–º—ã - –≤–∞–∂–Ω—ã –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          this.loadEvents()     // –ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è - –≤–∞–∂–Ω—ã –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        ]);

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ–Ω–µ, —á—Ç–æ–±—ã –Ω–µ –∑–∞–¥–µ—Ä–∂–∏–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        setTimeout(async () => {
          await Promise.allSettled([
            this.loadCertificates(),
            this.loadPromos(),
            this.loadLotteryData()
          ]);
        }, 100); // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
      }
    } else {
      // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
      if (!this.user) {
        console.log('User not found, authenticating...');
        await this.authenticate();
      }
    }
  }
}
</script>
