<template>
  <div class="p-4">
    <div class="flex items-center mb-4">
      <router-link to="/" class="btn-back mr-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
        </svg>
        –ù–∞–∑–∞–¥
      </router-link>
      <h1 class="page-title text-xl">–ö–ª—É–±–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è</h1>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div v-if="isLoading" class="flex justify-center items-center py-8">
      <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-[#4e5d51]"></div>
    </div>

    <!-- –û—à–∏–±–∫–∞ -->
    <div v-else-if="error" class="bg-red-50 border border-red-200 rounded-lg p-4 text-red-700 mb-4">
      {{ error }}
    </div>

    <div v-else class="space-y-4">
      <!-- –ë–∞–Ω–Ω—ã–π –∫–ª—É–± –°. –•–∞—á–∞—Ç—É—Ä—å—è–Ω–∞ -->
      <div class="card">
        <h2 class="section-title">‚ô®Ô∏è –ë–∞–Ω–Ω—ã–π –∫–ª—É–± –°. –•–∞—á–∞—Ç—É—Ä—å—è–Ω–∞</h2>
        <p class="text-black text-sm mb-3">–ê–≤—Ç–æ—Ä—Å–∫–∏–π –±–∞–Ω–Ω—ã–π –∫–ª—É–± –æ—Ç –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—è –°–ê–ù–°–ê–†–´</p>

        <div class="bg-gray-50 rounded-lg p-3 mb-3">
          <p class="text-black"><b>–ß—Ç–æ —ç—Ç–æ –∑–∞ —Ñ–æ—Ä–º–∞—Ç:</b></p>
          <p class="text-black text-sm">–ê–≤—Ç–æ—Ä—Å–∫–∏–π –±–∞–Ω–Ω—ã–π –∫–ª—É–± –æ—Ç –æ—Å–Ω–æ–≤–∞—Ç–µ–ª—è –∏ –∏–¥–µ–æ–ª–æ–≥–∞ –°–ê–ù–°–ê–†–´. –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –±–∞–Ω–Ω—É—é –∫—É–ª—å—Ç—É—Ä—É —Å —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–º –ø–æ–¥—Ö–æ–¥–æ–º.</p>

          <p class="text-black mt-2"><b>–ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Å—Ç—Ä–µ—á–∞:</b></p>
          <ul class="text-black text-sm list-disc pl-5">
            <li>–ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</li>
            <li>–õ–µ–∫—Ü–∏–æ–Ω–Ω–∞—è —á–∞—Å—Ç—å –æ –±–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–¥–∏—Ü–∏—è—Ö</li>
            <li>–ü—Ä–∞–∫—Ç–∏–∫–∞ –ø–∞—Ä–µ–Ω–∏—è –æ—Ç –º–∞—Å—Ç–µ—Ä–∞</li>
            <li>–û–±—Å—É–∂–¥–µ–Ω–∏–µ, —á–∞–π, –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥</li>
          </ul>

          <p class="text-black mt-2"><b>–î–ª—è –∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:</b></p>
          <p class="text-black text-sm">–î–ª—è —Ç–µ—Ö, –∫—Ç–æ —Ö–æ—á–µ—Ç –ø–æ–Ω—è—Ç—å —Å—É—Ç—å –±–∞–Ω–Ω–æ–π –∫—É–ª—å—Ç—É—Ä—ã, –Ω–∞–π—Ç–∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ –∏ –ø–æ–ª—É—á–∏—Ç—å –æ–ø—ã—Ç –æ—Ç –ø–µ—Ä–≤–æ–∏—Å—Ç–æ—á–Ω–∏–∫–∞.</p>

          <p class="text-black mt-2"><b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</b></p>
          <ul class="text-black text-sm list-disc pl-5">
            <li>–ö–∞–º–µ—Ä–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞</li>
            <li>–ê–≤—Ç–æ—Ä—Å–∫–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏ –ø–∞—Ä–µ–Ω–∏—è</li>
            <li>–ü–µ—Ä–µ–¥–∞—á–∞ –∑–Ω–∞–Ω–∏–π –∏ —Ç—Ä–∞–¥–∏—Ü–∏–π</li>
            <li>–°–æ–æ–±—â–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</li>
          </ul>
        </div>

        <!-- –ò—â–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –∫–ª—É–±–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
        <div v-if="clubEventProgram">
          <router-link
            :to="{
              name: 'BookingWithParams',
              params: {
                programId: clubEventProgram.id,
                programType: clubEventProgram.program_type,
                eventId: clubEventProgram.slug
              }
            }"
            class="btn-primary block text-center"
          >
            üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
          </router-link>
        </div>
        <div v-else>
          <router-link
            :to="{ name: 'BookingWithParams', params: { programType: 'club_event' }}"
            class="btn-primary block text-center opacity-70 cursor-not-allowed"
            disabled
          >
            üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
          </router-link>
          <p class="text-red-500 text-xs mt-1 text-center">
            –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
          </p>
        </div>
      </div>

      <!-- –ë–∏–∑–Ω–µ—Å-–±–∞–Ω—è —Å –∫–ª—É–±–æ–º –ú–û–°–¢ -->
      <div class="card">
        <h2 class="section-title">üíº –ë–∏–∑–Ω–µ—Å-–±–∞–Ω—è —Å –∫–ª—É–±–æ–º –ú–û–°–¢</h2>
        <p class="text-black text-sm mb-3">–ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥ –≤ –±–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π</p>

        <div class="bg-gray-50 rounded-lg p-3 mb-3">
          <p class="text-black"><b>–ß—Ç–æ —ç—Ç–æ –∑–∞ —Ñ–æ—Ä–º–∞—Ç:</b></p>
          <p class="text-black text-sm">–ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥ –≤ –±–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π –∏ –±–∏–∑–Ω–µ—Å–º–µ–Ω–æ–≤. –î–µ–ª–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ –≤ –Ω–µ—Ñ–æ—Ä–º–∞–ª—å–Ω–æ–π –æ–±—Å—Ç–∞–Ω–æ–≤–∫–µ.</p>

          <p class="text-black mt-2"><b>–ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤—Å—Ç—Ä–µ—á–∞:</b></p>
          <ul class="text-black text-sm list-disc pl-5">
            <li>–°–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ</li>
            <li>–ë–∞–Ω–Ω–∞—è —á–∞—Å—Ç—å —Å –æ–±—â–µ–Ω–∏–µ–º</li>
            <li>–ù–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥-—Å–µ—Å—Å–∏—è</li>
            <li>–û–±–º–µ–Ω –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏ –æ–ø—ã—Ç–æ–º</li>
            <li>–°–æ–≤–º–µ—Å—Ç–Ω—ã–π —á–∞–π</li>
          </ul>

          <p class="text-black mt-2"><b>–î–ª—è –∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∏—Ç:</b></p>
          <p class="text-black text-sm">–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏, —Ç–æ–ø-–º–µ–Ω–µ–¥–∂–µ—Ä—ã, —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä—ã ‚Äî –≤—Å–µ, –∫—Ç–æ —Ü–µ–Ω–∏—Ç –¥–µ–ª–æ–≤—ã–µ —Å–≤—è–∑–∏ –∏ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –æ–±—â–µ–Ω–∏—è.</p>

          <p class="text-black mt-2"><b>–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:</b></p>
          <ul class="text-black text-sm list-disc pl-5">
            <li>–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ</li>
            <li>–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–µ—Ç–≤–æ—Ä–∫–∏–Ω–≥</li>
            <li>–ë–∞–ª–∞–Ω—Å –¥–µ–ª–∞ –∏ –æ—Ç–¥—ã—Ö–∞</li>
            <li>–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏</li>
          </ul>
        </div>

        <!-- –ò—â–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –∫–ª—É–±–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π -->
        <div v-if="clubEventProgram">
          <router-link
            :to="{
              name: 'BookingWithParams',
              params: {
                programId: clubEventProgram.id,
                programType: clubEventProgram.program_type,
                eventId: clubEventProgram.slug
              }
            }"
            class="btn-primary block text-center"
          >
            üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
          </router-link>
        </div>
        <div v-else>
          <router-link
            :to="{ name: 'BookingWithParams', params: { programType: 'club_event' }}"
            class="btn-primary block text-center opacity-70 cursor-not-allowed"
            disabled
          >
            üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
          </router-link>
          <p class="text-red-500 text-xs mt-1 text-center">
            –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞
          </p>
        </div>
      </div>
    </div>

  </div>
</template>

<script>
import { mapState, mapActions } from 'pinia';
import { useAppStore } from '@/stores/appStore';

export default {
  name: 'ClubEventsPage',
  computed: {
    ...mapState(useAppStore, ['isLoading', 'error', 'events', 'programs', 'programsLoaded']),


    // –ù–∞—Ö–æ–¥–∏–º –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –∫–ª—É–±–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π
    clubEventProgram() {
      if (!this.programs || this.programs.length === 0) return null;

      // –°–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É —Å —Ç–∏–ø–æ–º 'club_event'
      let program = this.programs.find(p =>
        p.program_type === 'club_event'
      );

      // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –∏—â–µ–º –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
      if (!program) {
        program = this.programs.find(p =>
          p.name.toLowerCase().includes('–∫–ª—É–±') ||
          p.name.toLowerCase().includes('–±–∞–Ω–Ω—ã–π')
        );
      }

      return program || null;
    }
  },
  async mounted() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—ã, –µ—Å–ª–∏ –æ–Ω–∏ –µ—â–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
    if (!this.programsLoaded && this.loadPrograms) {
      await this.loadPrograms();
    }
  },
  methods: {
    ...mapActions(useAppStore, ['loadPrograms']),

    formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      return date.toLocaleDateString('ru-RU', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    },
  }
}
</script>