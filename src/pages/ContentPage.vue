<template>
  <div class="min-h-screen bg-gray-50">
    <div class="p-6">
      <div class="max-w-6xl mx-auto">
        <div class="mb-6">
          <h1 class="text-2xl font-bold text-gray-900">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</h1>
          <p class="text-gray-600">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –∏ –º–µ–¥–∏–∞-–∫–æ–Ω—Ç–µ–Ω—Ç–æ–º –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ —Å–∞–π—Ç–∞</p>
        </div>

        <!-- –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤ –∏ –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤ -->
        <div class="bg-white rounded-lg shadow p-6 space-y-8">
          <!-- –ë–ª–æ–∫ –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤ -->
          <div class="bachelor-section">
            <h2 class="text-xl font-semibold mb-4">üëî –ú–∞–ª—å—á–∏—à–Ω–∏–∫–∏</h2>

            <!-- –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤ -->
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤
              </label>
              <TextEditor
                v-model="bachelorContent.description"
                class="w-full"
              />
            </div>

            <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞ –¥–ª—è –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤ -->
            <div class="mb-6">
              <MediaUploader
                v-model="bachelorContent.media"
              />
            </div>
          </div>

          <!-- –ë–ª–æ–∫ –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤ -->
          <div class="bachelorette-section">
            <h2 class="text-xl font-semibold mb-4">üëó –î–µ–≤–∏—á–Ω–∏–∫–∏</h2>

            <!-- –†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤ -->
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2">
                –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤
              </label>
              <TextEditor
                v-model="bacheloretteContent.description"
                class="w-full"
              />
            </div>

            <!-- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–¥–∏–∞ –¥–ª—è –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤ -->
            <div class="mb-6">
              <MediaUploader
                v-model="bacheloretteContent.media"
              />
            </div>
          </div>

          <!-- –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è -->
          <div class="flex justify-end">
            <button
              @click="saveContent"
              class="btn-primary px-6 py-2 inline-flex items-center"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="-ml-1 mr-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
              –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { ref, reactive, onMounted } from 'vue';
import TextEditor from '@/components/TextEditor.vue';
import MediaUploader from '@/components/MediaUploader.vue';
import { contentApi } from '@/utils/contentApi.js';

export default {
  name: 'ContentPage',
  components: {
    TextEditor,
    MediaUploader
  },
  setup() {
    // –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤ –∏ –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤
    const bachelorContent = reactive({
      description: '<p>–ú—É–∂—Å–∫–æ–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –ø–µ—Ä–µ–¥ —Å–≤–∞–¥—å–±–æ–π –≤ –±–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ</p><p><strong>–ß—Ç–æ —ç—Ç–æ –∑–∞ —Ñ–æ—Ä–º–∞—Ç:</strong></p><p>–ú—É–∂—Å–∫–æ–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –ø–µ—Ä–µ–¥ —Å–≤–∞–¥—å–±–æ–π –≤ –±–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ ‚Äî —Å–æ—á–µ—Ç–∞–Ω–∏–µ —Ç—Ä–∞–¥–∏—Ü–∏–π, –æ—Ç–¥—ã—Ö–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ –Ω–æ–≤–æ–º—É —ç—Ç–∞–ø—É –∂–∏–∑–Ω–∏.</p><p><strong>–ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç:</strong></p><ul><li>–í—Å—Ç—Ä–µ—á–∞ –≥—Ä—É–ø–ø—ã –∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ–º</li><li>–ë–∞–Ω–Ω—ã–µ —Ä–∏—Ç—É–∞–ª—ã –∏ –ø–∞—Ä–µ–Ω–∏–µ</li><li>–û—Ç–¥—ã—Ö –≤ –∑–æ–Ω–µ —Ä–µ–ª–∞–∫—Å–∞</li><li>–ß–∞–π–Ω–∞—è —Ü–µ—Ä–µ–º–æ–Ω–∏—è</li><li>–ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</li></ul><p><strong>–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç:</strong></p><ul><li>–ü—Ä–∏–≤–∞—Ç–Ω–∞—è –∞—Ä–µ–Ω–¥–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞</li><li>–ë–∞–Ω—â–∏–∫-–ø–∞—Ä–∏–ª—å—â–∏–∫</li><li>–í–µ–Ω–∏–∫–∏, –ø–æ–ª–æ—Ç–µ–Ω—Ü–∞, —Ö–∞–ª–∞—Ç—ã</li><li>–ß–∞–π –∏ –ª–µ–≥–∫–∏–µ –∑–∞–∫—É—Å–∫–∏</li><li>3-4 —á–∞—Å–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã</li></ul>',
      media: {
        photos: [],
        videos: []
      }
    });

    const bacheloretteContent = reactive({
      description: '<p>–ñ–µ–Ω—Å–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ –∑–∞–±–æ—Ç—ã –∏ –∫—Ä–∞—Å–æ—Ç—ã ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥ —Å–≤–∞–¥—å–±–æ–π —Å –ø–æ–¥—Ä—É–≥–∞–º–∏.</p><p><strong>–ß—Ç–æ —ç—Ç–æ –∑–∞ —Ñ–æ—Ä–º–∞—Ç:</strong></p><p>–ñ–µ–Ω—Å–∫–∏–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä–µ –∑–∞–±–æ—Ç—ã –∏ –∫—Ä–∞—Å–æ—Ç—ã ‚Äî –∏–¥–µ–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è –ø–µ—Ä–µ–¥ —Å–≤–∞–¥—å–±–æ–π —Å –ø–æ–¥—Ä—É–≥–∞–º–∏.</p><p><strong>–ö–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç:</strong></p><ul><li>–í—Å—Ç—Ä–µ—á–∞ –∏ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –∞—Ç–º–æ—Å—Ñ–µ—Ä—É</li><li>–ú—è–≥–∫–æ–µ –ø–∞—Ä–µ–Ω–∏–µ —Å —Ç—Ä–∞–≤–∞–º–∏</li><li>–°–ü–ê-–ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∏ —É—Ö–æ–¥</li><li>–§–æ—Ç–æ–∑–æ–Ω–∞</li><li>–ß–∞–π–Ω–∞—è —Ü–µ—Ä–µ–º–æ–Ω–∏—è —Å –¥–µ—Å–µ—Ä—Ç–∞–º–∏</li></ul><p><strong>–ß—Ç–æ –≤–∫–ª—é—á–∞–µ—Ç:</strong></p><ul><li>–ü—Ä–∏–≤–∞—Ç–Ω–∞—è –∞—Ä–µ–Ω–¥–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞</li><li>–ú–∞—Å—Ç–µ—Ä –ø–∞—Ä–µ–Ω–∏—è</li><li>–ë–∞–Ω–Ω—ã–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏</li><li>–£—Ö–æ–¥–æ–≤—ã–µ –º–∞—Å–∫–∏ –∏ —Å–∫—Ä–∞–±—ã</li><li>–ß–∞–π, —Ñ—Ä—É–∫—Ç—ã, –¥–µ—Å–µ—Ä—Ç—ã</li><li>3-4 —á–∞—Å–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã</li></ul>',
      media: {
        photos: [],
        videos: []
      }
    });

    const loadContent = async () => {
      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤
        try {
          const bachelorData = await contentApi.getContent('bachelor');
          if (bachelorData) {
            bachelorContent.description = bachelorData.description || bachelorContent.description;
            bachelorContent.media = bachelorData.media || bachelorContent.media;
          }
        } catch (bachelorError) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤:', bachelorError);
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤
        try {
          const bacheloretteData = await contentApi.getContent('bachelorette');
          if (bacheloretteData) {
            bacheloretteContent.description = bacheloretteData.description || bacheloretteContent.description;
            bacheloretteContent.media = bacheloretteData.media || bacheloretteContent.media;
          }
        } catch (bacheloretteError) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤:', bacheloretteError);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', error);
      }
    };

    const saveContent = async () => {
      try {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤
        await contentApi.saveContent('bachelor', {
          description: bachelorContent.description,
          media: bachelorContent.media
        });

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤
        await contentApi.saveContent('bachelorette', {
          description: bacheloretteContent.description,
          media: bacheloretteContent.media
        });

        alert('–ö–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –º–∞–ª—å—á–∏—à–Ω–∏–∫–æ–≤ –∏ –¥–µ–≤–∏—á–Ω–∏–∫–æ–≤ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', error);
        alert(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ${error.message}`);
      }
    };

    onMounted(async () => {
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
      await loadContent();
    });

    return {
      bachelorContent,
      bacheloretteContent,
      saveContent
    };
  }
}
</script>